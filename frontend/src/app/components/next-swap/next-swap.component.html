<section class="interchange-section">
  <ng-container *ngIf="hasIntercambio(); else noIntercambio">
    <div class="interchange-box">
      <div class="interchange-content">
        
        <div class="interchange-card-wrapper">
          <h3 class="section-title">Aprenderás</h3>

          <div class="skill-card">
            <div class="img-wrapper">
              <img [src]="imageToLearn()" alt="{{ nextSwap()?.skill }}" class="activity-img">
            </div>
            
            <div class="card-details">
              <div class="card-header-info">
                <h4>Clase de {{ nextSwap()?.skill }}</h4>
                
                <div class="level-container" [ngClass]="{
                  'mid-level': getSkillLevel(profileToLearn()?.skills || [], nextSwap()?.skill || '') === 2,
                  'high-level': getSkillLevel(profileToLearn()?.skills || [], nextSwap()?.skill || '') === 3
                }">
                  <span class="level-text">{{ getLevelText(getSkillLevel(profileToLearn()?.skills || [], nextSwap()?.skill || '')) }}</span>
                  <div class="level-bar">
                    <div class="level-block" [class.filled]="getSkillLevel(profileToLearn()?.skills || [], nextSwap()?.skill || '') >= 1"></div>
                    <div class="level-block" [class.filled]="getSkillLevel(profileToLearn()?.skills || [], nextSwap()?.skill || '') >= 2"></div>
                    <div class="level-block" [class.filled]="getSkillLevel(profileToLearn()?.skills || [], nextSwap()?.skill || '') >= 3"></div>
                  </div>
                </div>
              </div>
              
              <div class="badges-group">
                <div class="info-badge" [title]="profileToLearn()?.location?.displayName">
                  <span class="material-symbols-outlined badge-icon">location_on</span>
                  <span class="badge-text">{{ profileToLearn()?.location?.displayName }}</span>
                </div>
                
                <div class="info-badge user-link-container" [routerLink]="['/user', profileToLearn()?.username]" [title]="'@' + profileToLearn()?.username">
                  <div class="avatar-wrapper">
                    <img [src]="profileToLearn()?.profilePhotoUrl" alt="Avatar" class="user-avatar" />
                  </div>
                  <span class="badge-text">{{ '@'+ profileToLearn()?.username }}</span>
                  <span class="rating">
                    <span class="material-symbols-outlined star-icon">{{ getStarIcon(profileToLearn()?.rating ?? 0) }}</span>
                    <span class="rating-value">{{ profileToLearn()?.rating }}</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="arrow-container">
          <div class="swap-icon-wrapper pulse-animation">
            <span class="material-symbols-outlined swap-icon">swap_horiz</span>
          </div>
        </div>

        <div class="interchange-card-wrapper">
          <h3 class="section-title">Enseñarás</h3>

          <div class="skill-card">
            <div class="img-wrapper">
              <img [src]="imageToTeach()" alt="{{ nextSwap()?.interest }}" class="activity-img">
            </div>
            
            <div class="card-details">
              <div class="card-header-info">
                <h4>Clase de {{ nextSwap()?.interest }}</h4>
              </div>

              <div class="badges-group">
                <div class="info-badge" [title]="profileToTeach()?.location?.displayName">
                  <span class="material-symbols-outlined badge-icon">location_on</span>
                  <span class="badge-text">{{ profileToTeach()?.location?.displayName }}</span>
                </div>
                
                <div class="info-badge user-link-container" [routerLink]="['/user', profileToTeach()?.username]" [title]="'@' + profileToTeach()?.username">
                  <div class="avatar-wrapper">
                    <img [src]="profileToTeach()?.profilePhotoUrl" alt="Avatar" class="user-avatar" />
                  </div>
                  <span class="badge-text">{{ "@" + profileToTeach()?.username }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="actions-area">
        <ng-container *ngIf="isConfirmed()">
          <span class="status-badge confirmed">
            <span class="material-symbols-outlined">check_circle</span>
            Intercambio confirmado
          </span>
        </ng-container>

        <ng-container *ngIf="isDenied()">
          <span class="status-badge denied">
            <span class="material-symbols-outlined">cancel</span>
            Intercambio rechazado
          </span>
        </ng-container>

        <ng-container *ngIf="!isConfirmed() && !isDenied()">
          <button class="btn-action btn-reject" (click)="denyIntercambio()">
            <span class="material-symbols-outlined">close</span>
            Rechazar
          </button>

          <button class="btn-action btn-accept" (click)="confirmIntercambio()">
            <span class="material-symbols-outlined">done</span>
            Aceptar intercambio
          </button>
        </ng-container>
      </div>
    </div>
  </ng-container>

  <ng-template #noIntercambio>
    <div class="interchange-box empty-state">
      <span class="material-symbols-outlined empty-icon pulse-animation-slow">event_busy</span>
      <p>No tienes ningún intercambio programado por ahora.</p>
    </div>
  </ng-template>
</section>