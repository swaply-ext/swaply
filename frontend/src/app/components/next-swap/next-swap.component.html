<section class="interchange-section">
  <ng-container *ngIf="hasIntercambio(); else noIntercambio">
    
    <div class="interchange-box">
      <div class="interchange-content">

        <div class="interchange-card-wrapper">
          <h3 class="section-title">Tu próxima habilidad para aprender</h3>
          
          <div class="skill-card">
            <img [src]="imageToLearn()" alt="{{ nextSwap()?.interest }}" class="activity-img">
            
            <div class="card-details">
              <h4>Clase de {{ nextSwap()?.interest }}</h4>
              
              <div class="level-container" [ngClass]="{
                'mid-level': getSkillLevel(profileToLearn()?.skills || [], nextSwap()?.interest || '') === 2,
                'high-level': getSkillLevel(profileToLearn()?.skills || [], nextSwap()?.interest || '') === 3
              }">
                <span class="level-text">{{ getLevelText(getSkillLevel(profileToLearn()?.skills || [], nextSwap()?.interest || '')) }}</span>
                <div class="level-bar">
                  <div class="level-block" [class.filled]="getSkillLevel(profileToLearn()?.skills || [], nextSwap()?.interest || '') >= 1"></div>
                  <div class="level-block" [class.filled]="getSkillLevel(profileToLearn()?.skills || [], nextSwap()?.interest || '') >= 2"></div>
                  <div class="level-block" [class.filled]="getSkillLevel(profileToLearn()?.skills || [], nextSwap()?.interest || '') >= 3"></div>
                </div>
              </div>
              
              <div class="badges-group">
                <div class="info-badge">
                  <span class="material-symbols-outlined badge-icon">location_on</span>
                  <span class="badge-text">{{ profileToLearn()?.location }}</span>
                </div>
                <div class="info-badge user-link-container" 
                     [routerLink]="['/public-profile', profileToLearn()?.username]"
                     style="cursor: pointer;">
                  
                  <div class="avatar-wrapper">
                    <img [src]="profileToLearn()?.profilePhotoUrl" alt="Avatar" class="user-avatar">
                  </div>
                  <span class="badge-text">{{ '@'+ profileToLearn()?.username }}</span>
                  <span class="rating">
                    <span class="material-symbols-outlined star-icon">{{ getStarIcon(profileToLearn()?.rating ?? 0) }}</span>
                    <span class="rating-value">{{ profileToLearn()?.rating }}</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="arrow-container">
          <span class="material-symbols-outlined swap-icon">swap_horiz</span>
        </div>

        <div class="interchange-card-wrapper">
          <h3 class="section-title">Tu próxima habilidad para enseñar</h3>
          
          <div class="skill-card">
            <img [src]="imageToTeach()" alt="{{ nextSwap()?.skill }}" class="activity-img">
            
            <div class="card-details">
              <h4>Clase de {{ nextSwap()?.skill }}</h4>

              <div class="badges-group">
                <div class="info-badge">
                  <span class="material-symbols-outlined badge-icon">location_on</span>
                  <span class="badge-text">{{ profileToTeach()?.location }}</span>
                </div>   
                <div class="info-badge user-link-container"
                     [routerLink]="['/public-profile', profileToTeach()?.username]"
                     style="cursor: pointer;">
                  
                  <div class="avatar-wrapper">
                    <img [src]="profileToTeach()?.profilePhotoUrl" alt="Avatar" class="user-avatar">
                  </div>
                  <span class="badge-text">{{ '@'+ profileToTeach()?.username }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="actions-area">
        
        <ng-container *ngIf="isConfirmed()">
          <span class="status-badge confirmed">
            <span class="material-symbols-outlined">check_circle</span>
            Intercambio confirmado
          </span>
        </ng-container>

        <ng-container *ngIf="isDenied()">
          <span class="status-badge denied">
            <span class="material-symbols-outlined">cancel</span>
            Intercambio rechazado
          </span>
        </ng-container>

        <ng-container *ngIf="!isConfirmed() && !isDenied()">
          <button class="btn-action btn-reject" (click)="denyIntercambio()">
            <span class="material-symbols-outlined">cancel</span>
            Rechazar intercambio
          </button>
          
          <button class="btn-action btn-accept" (click)="confirmIntercambio()">
            <span class="material-symbols-outlined">check_circle</span>
            Aceptar intercambio
          </button>
        </ng-container>

      </div>
    </div>
  </ng-container>

  <ng-template #noIntercambio>
    <div class="interchange-box empty-state">
      <p>No tienes ningún intercambio programado.</p>
    </div>
  </ng-template>
</section>