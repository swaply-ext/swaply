<div class="chat-layout">

  <!-- SIDEBAR -->
  <aside class="chat-sidebar">

    <div class="sidebar-header">
      <h2>Missatges</h2>
    </div>

    <div class="rooms-list">
      @for (room of rooms; track room.id) {
        <div
          class="room-item"
          [class.active]="selectedRoom?.id === room.id"
          (click)="selectRoom(room)">

          <div class="avatar">
            {{ room.displayUsername.charAt(0) | uppercase }}
          </div>

          <div class="room-info">
            <div class="room-top">
              <span class="room-name">{{ room.displayUsername }}</span>
              <span class="room-time" *ngIf="room.lastMessageTime">
                {{ room.lastMessageTime | date:'HH:mm' }}
              </span>
            </div>

            <div class="room-preview">
              {{ room.lastMessagePreview || 'Inicia una conversaciÃ³n...' }}
            </div>
          </div>
        </div>
      } @empty {
        <div class="empty-state">
          No tens xats actius
        </div>
      }
    </div>
  </aside>

  <!-- CHAT WINDOW -->
  <main class="chat-window">

    @if (selectedRoom) {

      <!-- HEADER -->
      <header class="chat-header">
        <div class="avatar-small">
          {{ selectedRoom.displayUsername.charAt(0) | uppercase }}
        </div>
        <div class="header-info">
          <h3>{{ selectedRoom.displayUsername }}</h3>
          <span class="status">online</span>
        </div>
      </header>

      <!-- MESSAGES -->
      <div class="messages-container" #scrollContainer>
        @for (msg of messages; track msg.id) {
          <div
            class="message-bubble"
            [class.mine]="msg.senderId === currentUserId"
            [class.theirs]="msg.senderId !== currentUserId">

            <p class="message-text">{{ msg.content }}</p>
            <span class="message-meta">
              {{ msg.timestamp | date:'HH:mm' }}
            </span>
          </div>
        }
      </div>

      <!-- INPUT -->
      <div class="chat-input">
        <input
          type="text"
          [(ngModel)]="newMessageText"
          (keyup.enter)="sendMessage()"
          placeholder="Escribe un mensaje..." />

        <button
          (click)="sendMessage()"
          [disabled]="!newMessageText.trim()">
          âž¤
        </button>
      </div>

    } @else {

      <!-- EMPTY STATE -->
      <div class="no-chat-selected">
        <span class="big-icon">ðŸ’¬</span>
        <p>Selecciona una conversa per comenÃ§ar</p>
      </div>

    }

  </main>
</div>
