<app-app-navbar></app-app-navbar>

<div class="swap-page-container">
  
  <div class="interchange-box">
    <div class="interchange-content">
      
      <div class="interchange-card-wrapper" *ngIf="myUser() as me">
        <h3 class="section-title">Lo que puedes ofrecer</h3>

        <div class="skill-card interactive-card" *ngIf="selectedTeachSkill() as mySkill">
          <div class="img-wrapper">
            <img class="activity-img" [src]="mySkill.image || 'assets/default-avatar.png'" [alt]="mySkill.name" />
          </div>
          
          <div class="card-details">
            <div class="card-header-info">
              <h4>{{ getTeachSkillName() }}</h4>
            </div>
            
            <div class="badges-group">
              <div class="info-badge" [title]="me.location?.displayName">
                <span class="material-symbols-outlined badge-icon">location_on</span>
                <span class="badge-text">{{ validateInputsService.formatLocation(me.location.displayName) }}</span>
              </div>
              
              <div class="info-badge user-link-container">
                <div class="avatar-wrapper">
                  <img class="user-avatar" [src]="me.profilePhotoUrl || 'assets/default-avatar.png'" alt="Avatar" />
                </div>
                <span class="badge-text">{{ "@" + me.username }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="arrow-container">
        <div class="swap-icon-wrapper pulse-animation">
          <span class="material-symbols-outlined swap-icon">swap_horiz</span>
        </div>
      </div>

      <div class="interchange-card-wrapper" *ngIf="selectedTargetSkill() as targetSkill">
        <h3 class="section-title">Lo que quieres aprender</h3>

        <div class="skill-card interactive-card">
          <div class="img-wrapper">
            <img class="activity-img" [src]="getTargetSkillImage()" [alt]="getTargetSkillName()" />
          </div>
          
          <div class="card-details">
            <div class="card-header-info">
              <h4>{{ getTargetSkillName() }}</h4>
            </div>

            <div class="badges-group">
              <div class="info-badge" [title]="targetUser()?.location?.displayName">
                <span class="material-symbols-outlined badge-icon">location_on</span>
                <span class="badge-text">{{ validateInputsService.formatLocation(targetUser()?.location?.displayName) }}</span>
              </div>
              
              <div class="info-badge user-link-container" [routerLink]="['/user', targetUser()?.username]" [title]="'@' + targetUser()?.username">
                <div class="avatar-wrapper">
                  <img class="user-avatar" [src]="targetUser()?.profilePhotoUrl || 'assets/default-avatar.png'" alt="Avatar" />
                </div>
                <span class="badge-text">{{ "@" + targetUser()?.username }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="panel-actions">
    
    <div class="panel skills-panel" *ngIf="myUser() as me">
      <ng-container *ngIf="mySkillsDisplay().length > 0; else noMySkills">
        <app-swap-skills
          [SkillsInput]="mySkillsDisplay()"
          [editable]="false"
          (skillSelected)="selectMySkill($event)">
        </app-swap-skills>
      </ng-container>

      <ng-template #noMySkills>
        <div class="empty-state">
           <span class="material-symbols-outlined icon-empty">block</span>
           <p>No tienes habilidades que coincidan con los intereses de {{ "@" + targetUser()?.username }}</p>
        </div>
      </ng-template>
    </div>
    
    <div class="panel interests-panel" *ngIf="targetUserInterests() as interests">
      <ng-container *ngIf="interests.length > 0; else noTargetSkills">
        <app-swap-interests
          [InterestsInput]="interests"
          [editable]="false"
          [targetUser]="targetUser()"
          (skillSelected)="selectTargetInterest($event)">
        </app-swap-interests>
      </ng-container>

      <ng-template #noTargetSkills>
        <div class="empty-state">
           <span class="material-symbols-outlined icon-empty">block</span>
           <p>{{"@" + targetUser()?.username }} no ofrece habilidades que coincidan con tus intereses.</p>
        </div>
      </ng-template>
    </div>

  </div>

  <div class="btn-container">
    <button class="btn-action btn-reject" (click)="cancelSwap()">
      <span class="material-symbols-outlined">close</span>
      CANCELAR
    </button>
    
    <button class="btn-action btn-accept" 
            (click)="createSwap()"
            [disabled]="mySkillsDisplay().length === 0 || targetUserInterests().length === 0">
      <span class="material-symbols-outlined">done</span>
      SOLICITAR SWAP
    </button>
  </div>

</div>